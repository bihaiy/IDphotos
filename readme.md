# 证件照制作系统

## 功能特点
- 智能抠图：支持多种抠图模型，精准分离人像
- 智能美颜：本地美颜和Face++美颜双引擎支持
- 换背景：支持纯色、渐变背景，提供多种预设颜色
- 证照排版：提供多种预设排版样式，支持自定义排版
- 一键制作：一键完成抠图、美颜、换底、排版全流程

## 安装说明

### 环境要求
- Python 3.8+
- pip包管理器
- Windows 7/10/11

### 安装步骤
1. 克隆或下载项目代码
2. 创建并激活虚拟环境（推荐）：
   ```bash
   python -m venv venv
   venv\Scripts\activate
   ```
3. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
4. 运行程序：
   ```bash
   python main.py
   ```

### 打包说明
1. 安装PyInstaller：
   ```bash
   pip install pyinstaller
   ```
2. 执行打包命令：
   ```bash
   pyinstaller idphoto.spec
   ```
3. 打包完成后，可执行文件位于 `dist` 目录

## 使用说明

### 基本操作流程
1. 上传照片：
   - 点击左上角预览区的"上传"按钮
   - 支持jpg、png格式的图片
   - 可通过菜单栏"文件->打开"上传

2. 抠图处理：
   - 点击"抠图"按钮或使用菜单栏"编辑->抠图"
   - 可调整面部比例(0.1-0.5)和头顶距离(0.05-0.3)
   - 支持人脸矫正和高清照片输出
   - 可选择不同的抠图模型和人脸检测模型

3. 换背景：
   - 点击"换背景"按钮或使用菜单栏"编辑->换背景"
   - 支持纯色背景和渐变背景
   - 提供多种预设颜色和自定义颜色
   - 可调整渐变方向和强度

4. 证照排版：
   - 点击"证照排版"按钮或使用菜单栏"编辑->证照排版"
   - 提供多种预设排版样式
   - 可自定义排版参数和照片尺寸
   - 支持显示参考线和分隔线

### 照片编辑
1. 基础调整：
   - 亮度：-50 到 50
   - 对比度：-30 到 50
   - 饱和度：-50 到 50
   - 色相：-30 到 30
   - 锐化：0 到 30

2. 本地美颜：
   - 磨皮：0 到 50
   - 美白：0 到 30
   - 瘦脸：0 到 20
   - 大眼：0 到 15

3. Face++美颜：
   - 需配置Face++ API密钥
   - 支持多种美颜参数调节
   - 提供35种滤镜效果

### 尺寸管理
1. 通过菜单栏"工具->尺寸管理"打开管理窗口
2. 支持添加、编辑、删除和排序
3. 可管理纸张尺寸和证件照尺寸
4. 所有尺寸数据保存在JSON配置文件中

### 保存与导出
1. 支持保存多种格式：
   - 透明照片(PNG)
   - 换底照片(JPG)
   - 排版照片(JPG)
2. 可通过菜单栏"文件"进行相应操作
3. 支持一键制作完整流程

### 快捷键
- Ctrl+O：打开图片
- Ctrl+S：保存当前照片
- Ctrl+Z：撤销操作
- Ctrl+Y：重做操作
- Ctrl+P：打印排版

## 常见问题(FAQ)

### 1. Face++美颜功能无法使用
- 确认已正确配置Face++ API密钥
- 检查网络连接是否正常
- 确认API调用次数未超出限制

### 2. 抠图效果不理想
- 确保照片光线充足、背景简单
- 尝试调整面部比例和头顶距离参数
- 选择不同的抠图模型进行尝试

### 3. 排版照片模糊
- 检查原始照片分辨率是否足够
- 开启高清照片选项
- 确认打印机DPI设置正确

### 4. 程序运行缓慢
- 使用1MB以下的照片
- 关闭不必要的美颜效果
- 确保电脑内存充足

## 项目结构
```
├── config/              # 配置文件目录
│   ├── __init__.py
│   └── default_sizes.py # 默认尺寸配置
├── dialogs/             # 对话框界面
│   ├── __init__.py
│   ├── api_setting.py   # API设置对话框
│   ├── custom_size.py   # 自定义尺寸对话框
│   ├── layout_editor.py # 排版样式编辑器
│   ├── photo_editor.py  # 照片编辑器
│   └── size_manager.py  # 尺寸管理器
├── processors/          # 图像处理
│   ├── __init__.py
│   └── image_processor.py # 图像处理器
├── ui/                  # 用户界面
│   ├── __init__.py
│   ├── preview.py      # 预览区管理
│   ├── params.py       # 参数管理
│   ├── menu.py         # 菜单管理
│   ├── matting_params.py # 抠图参数
│   ├── background_params.py # 背景参数
│   └── layout_params.py # 排版参数
├── utils/              # 工具函数
│   ├── __init__.py
│   ├── constants.py    # 常量定义
│   ├── image_utils.py  # 图像工具
│   ├── layout_preview.py # 排版预览
│   └── style.py        # 界面样式
├── beauty/             # 美颜处理
│   ├── __init__.py
│   ├── face_beauty.py  # 人脸美颜
│   └── skin_beauty.py  # 皮肤美白
├── main.py            # 主程序入口
├── requirements.txt   # 依赖包列表
├── idphoto.spec      # 打包配置
└── README.md         # 项目文档
```

## 贡献指南
1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

## 许可证
本项目采用 MIT 许可证。详见 [LICENSE](LICENSE) 文件。

## 联系方式
- 问题反馈：通过 GitHub Issues
- 功能建议：通过 GitHub Discussions
- 邮件支持：bihaiy@gmail.com

## 更新记录

### 2025-01-04
- 优化了排版功能：
  - 添加了1寸5张2寸4张混排预设样式
  - 优化了排版参数的默认值
  - 改进了排版预览的显示效果
  - 完善了排版样式的保存机制

### 2024-01-09
- 优化了预览区功能：
  - 在预览区添加了"抠图"、"换背景"、"证照排版"按钮
  - 优化了按钮显示逻辑，有照片时隐藏，无照片时显示
  - 改进了按钮样式，与上传按钮保持一致
- 优化了操作流程：
  - 点击换背景时自动执行上传和抠图
  - 改进了参数标签页的切换逻辑
  - 完善了图片数据的清理机制

### 2024-01-08
- 优化了自定义尺寸管理功能：
  - 添加了尺寸列表的手动排序功能
  - 修复了编辑时尺寸显示的问题
  - 改进了窗口显示位置，现在会居中显示
  - 移除了不必要的操作提示
  - 优化了用户界面交互体验
- 修改了默认设置：
  - 照片间隔默认值改为2mm
  - 默认显示间隔线
  - 页边距默认值设为5mm

### 2024-01-07
- 添加了纸张尺寸和证件照尺寸的JSON配置文件
- 实现了纸张尺寸和证件照尺寸的管理功能
- 添加了自定义纸张和证件照尺寸的功能
- 添加了页边距设置功能，支持上下左右四个方向独立设置

### 2024-01-06
- 完善了核心功能模块：
  - 实现了背景功能，支持多种渲染方式
  - 添加了美颜参数调节功能
  - 实现了打印排版功能
- 优化了用户界面：
  - 添加了参数调节滑动条
  - 实现了实时预览功能
  - 添加了图片下载功能
- 增加了打印功能支持
- 添加了配置保存和加载功能

### 2024-01-05
- 创建了基础的软件界面框架
- 实现了主要功能区域的布局：
  - 左侧预览区（上传区和三个预览窗口）
  - 右侧参数设置区（使用选项卡组织）
- 添加了基本的图片处理功能：
  - 图片上传和预览
  - 图片压缩和格式转换
  - 基础的抠图功能